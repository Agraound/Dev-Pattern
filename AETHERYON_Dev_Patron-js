Aqu√≠ tienes una versi√≥n para desarrollo JavaScript/Node.js del patr√≥n AETHERYON, manteniendo la misma estructura progresiva y principios arquitect√≥nicos.

```markdown
# AETHERYON Dev Pattern ‚Äî JavaScript/Node.js

---

## Tabla Comparativa de Niveles

| Nivel | Nombre            | Equipo   | Complejidad | Testing  | MVVM | Cu√°ndo usarlo                                           |
|-------|-------------------|----------|-------------|----------|------|---------------------------------------------------------|
| 1     | Standalone Script | 1 dev    | M√≠nima      | No       | No   | Prototipo, validaci√≥n r√°pida, scripts de automatizaci√≥n |
| 2     | BF                | 1-2 devs | Baja        | No       | No   | Proyecto peque√±o con l√≥gica separada de presentaci√≥n    |
| 3     | AUDI              | 2-4 devs | Media       | Opcional | No   | Proyecto con dominio definido y crecimiento esperado    |
| 4     | AUDDITS           | 3-6 devs | Alta        | S√≠       | No   | Producto en producci√≥n con m√∫ltiples m√≥dulos            |
| 5     | AUDDITS + MVVM    | 4+ devs  | Muy alta    | S√≠       | S√≠   | Sistema complejo con UI rica y m√∫ltiples vistas         |

---

## Nivel 1 ‚Äî Standalone Script
Proyecto desarrollado en un √∫nico script completamente funcional.

### Cu√°ndo escalar al Nivel 2
Escalar cuando el script supere las 200 l√≠neas, cuando la l√≥gica de negocio y la presentaci√≥n se mezclen en las mismas funciones, o cuando otro desarrollador necesite trabajar en paralelo.

### Principios del Nivel 1
- Todo en un solo archivo es aceptable mientras el alcance sea claro.
- Preferir funciones puras y evitar estado global innecesario.
- Documentar la intenci√≥n del script al inicio del archivo.

### Antipatrones a evitar
```javascript
// ‚ùå MAL ‚Äî l√≥gica mezclada con presentaci√≥n
function calcularDescuento(precio, porcentaje) {
    const resultado = precio - (precio * porcentaje / 100);
    console.log(`Descuento aplicado: ${resultado}`); // mezcla c√°lculo con output
    return resultado;
}

// ‚úÖ BIEN ‚Äî responsabilidades separadas aunque est√©n en el mismo archivo
function calcularDescuento(precio, porcentaje) {
    return precio - (precio * porcentaje / 100);
}

function mostrarResultado(resultado) {
    console.log(`Descuento aplicado: ${resultado}`);
}
```

### Modos Operativos del Sistema

- Script Mode ‚Üí Validaci√≥n r√°pida y prototipo funcional.
- CLI Mode ‚Üí Ejecuci√≥n interactiva por comandos.
- Batch Mode ‚Üí Automatizaci√≥n por par√°metros (--flags).
- UI Mode ‚Üí Orquestaci√≥n profesional mediante interfaz gr√°fica.

### Ejemplo: Standalone Script con todos los modos

```javascript
#!/usr/bin/env node
/**
 * proyecto.js - Script √∫nico con m√∫ltiples modos operativos
 */

const fs = require('fs').promises;
const path = require('path');
const { program } = require('commander');
const readline = require('readline');

// ==================== DOMAIN ====================
const TipoUsuario = {
    ADMIN: 'admin',
    USUARIO: 'usuario',
    INVITADO: 'invitado'
};

class Usuario {
    constructor(id, nombre, email, tipo, activo = true) {
        this.id = id;
        this.nombre = nombre;
        this.email = email;
        this.tipo = tipo;
        this.activo = activo;
    }

    cambiarEmail(nuevoEmail) {
        if (!nuevoEmail.includes('@')) {
            throw new Error('Email inv√°lido: debe contener @');
        }
        this.email = nuevoEmail;
    }

    desactivar() {
        this.activo = false;
    }
}

// ==================== APPLICATION ====================
class ServicioUsuario {
    constructor() {
        this._usuarios = [];
        this._nextId = 1;
    }

    crearUsuario(nombre, email, tipo) {
        if (!nombre || nombre.length < 3) {
            throw new Error('Nombre debe tener al menos 3 caracteres');
        }
        if (!email || !email.includes('@')) {
            throw new Error('Email inv√°lido');
        }
        const usuario = new Usuario(this._nextId++, nombre, email, tipo);
        this._usuarios.push(usuario);
        console.log(`Usuario creado: ${usuario.nombre} (ID: ${usuario.id})`);
        return usuario;
    }

    listarUsuarios(soloActivos = false) {
        if (soloActivos) {
            return this._usuarios.filter(u => u.activo);
        }
        return [...this._usuarios];
    }

    obtenerUsuario(usuarioId) {
        return this._usuarios.find(u => u.id === usuarioId);
    }

    eliminarUsuario(usuarioId) {
        const usuario = this.obtenerUsuario(usuarioId);
        if (usuario) {
            usuario.desactivar();
            return true;
        }
        return false;
    }
}

// ==================== INTERFACES ====================
class CLI {
    constructor(servicio) {
        this.servicio = servicio;
    }

    ejecutar(options) {
        const comandos = {
            'crear': this._crear.bind(this),
            'listar': this._listar.bind(this),
            'obtener': this._obtener.bind(this),
            'eliminar': this._eliminar.bind(this)
        };

        if (comandos[options.comando]) {
            comandos[options.comando](options);
        }
    }

    _crear(options) {
        try {
            const usuario = this.servicio.crearUsuario(
                options.nombre,
                options.email,
                options.tipo
            );
            console.log(`‚úÖ Usuario creado: ${usuario.nombre} (ID: ${usuario.id})`);
        } catch (error) {
            console.log(`‚ùå Error: ${error.message}`);
        }
    }

    _listar(options) {
        const usuarios = this.servicio.listarUsuarios(options.soloActivos);
        if (usuarios.length === 0) {
            console.log('No hay usuarios');
            return;
        }
        
        console.log('\nID    NOMBRE                EMAIL                      TIPO       ESTADO');
        console.log('-'.repeat(70));
        
        usuarios.forEach(u => {
            const estado = u.activo ? 'ACTIVO' : 'INACTIVO';
            console.log(`${u.id.toString().padEnd(4)} ${u.nombre.padEnd(20)} ${u.email.padEnd(25)} ${u.tipo.padEnd(10)} ${estado}`);
        });
    }

    _obtener(options) {
        const usuario = this.servicio.obtenerUsuario(parseInt(options.id));
        if (usuario) {
            console.log(`\nID: ${usuario.id}\nNombre: ${usuario.nombre}\nEmail: ${usuario.email}`);
        } else {
            console.log(`‚ùå Usuario con ID ${options.id} no encontrado`);
        }
    }

    _eliminar(options) {
        if (this.servicio.eliminarUsuario(parseInt(options.id))) {
            console.log(`‚úÖ Usuario ${options.id} desactivado`);
        } else {
            console.log(`‚ùå Usuario con ID ${options.id} no encontrado`);
        }
    }
}

// ==================== MAIN ====================
async function main() {
    program
        .version('1.0.0')
        .description('Sistema de Gesti√≥n de Usuarios');

    program
        .command('crear <nombre> <email> <tipo>')
        .action((nombre, email, tipo) => {
            const servicio = new ServicioUsuario();
            new CLI(servicio).ejecutar({ comando: 'crear', nombre, email, tipo });
        });

    program
        .command('listar')
        .option('-a, --solo-activos', 'Mostrar solo usuarios activos')
        .action((options) => {
            const servicio = new ServicioUsuario();
            new CLI(servicio).ejecutar({ comando: 'listar', soloActivos: options.soloActivos });
        });

    program
        .command('obtener <id>')
        .action((id) => {
            const servicio = new ServicioUsuario();
            new CLI(servicio).ejecutar({ comando: 'obtener', id });
        });

    program
        .command('eliminar <id>')
        .action((id) => {
            const servicio = new ServicioUsuario();
            new CLI(servicio).ejecutar({ comando: 'eliminar', id });
        });

    await program.parseAsync(process.argv);
}

if (require.main === module) {
    main().catch(console.error);
}
```

### package.json m√≠nimo
```json
{
  "name": "proyecto",
  "version": "1.0.0",
  "description": "Script √∫nico con m√∫ltiples modos operativos",
  "main": "proyecto.js",
  "bin": {
    "proyecto": "./proyecto.js"
  },
  "dependencies": {
    "commander": "^11.0.0"
  }
}
```

### Ejemplo de uso

```bash
node proyecto.js crear "Juan P√©rez" "juan@email.com" admin
node proyecto.js listar
node proyecto.js listar --solo-activos
node proyecto.js obtener 1
node proyecto.js eliminar 1
```

### Estructura

```
proyecto/
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ proyecto.js
```

---

## Nivel 2 ‚Äî Patr√≥n BF (Backend‚ÄìFrontend)
Separaci√≥n b√°sica entre l√≥gica y presentaci√≥n.

### Cu√°ndo escalar al Nivel 3
Escalar cuando aparezcan m√∫ltiples entidades de negocio con reglas propias, cuando Infrastructure comience a crecer (base de datos, APIs externas), o cuando el equipo crezca y la separaci√≥n en dos archivos ya no alcance para dividir el trabajo.

### Principios del Nivel 2
- `backend.js` contiene toda la l√≥gica de negocio y acceso a datos.
- `frontend.js` (o `cli.js`/`ui.js`) solo consume m√©todos p√∫blicos del backend.
- El frontend nunca importa librer√≠as de acceso a datos directamente.

### Antipatrones a evitar
```javascript
// ‚ùå MAL ‚Äî el frontend accede directamente a la base de datos
// En frontend.js
const sqlite3 = require('sqlite3');
const db = new sqlite3.Database('db.sqlite');
db.all('SELECT * FROM usuarios', (err, rows) => {
    // l√≥gica aqu√≠
});

// ‚úÖ BIEN ‚Äî el frontend delega al backend
// En frontend.js
const Backend = require('./backend');
const backend = new Backend();
const usuarios = await backend.obtenerUsuarios();
```

### Ejemplo: Backend-Frontend con readline-sync (CLI)

**backend.js**
```javascript
/**
 * backend.js - L√≥gica de negocio y persistencia
 * Independiente de la interfaz de usuario
 */

const fs = require('fs').promises;
const path = require('path');

class Tarea {
    constructor(id, titulo, descripcion = '', completada = false, fechaCreacion = null) {
        this.id = id;
        this.titulo = titulo;
        this.descripcion = descripcion;
        this.completada = completada;
        this.fechaCreacion = fechaCreacion || new Date().toISOString();
    }
}

class GestorTareas {
    constructor() {
        this._tareas = [];
        this._nextId = 1;
    }

    agregar(titulo, descripcion = '') {
        if (!titulo || titulo.trim().length === 0) {
            throw new Error('El t√≠tulo no puede estar vac√≠o');
        }
        const tarea = new Tarea(this._nextId++, titulo.trim(), descripcion);
        this._tareas.push(tarea);
        return tarea;
    }

    completar(tareaId) {
        const tarea = this._obtenerPorId(tareaId);
        if (tarea) {
            tarea.completada = !tarea.completada;
            return true;
        }
        return false;
    }

    eliminar(tareaId) {
        const index = this._tareas.findIndex(t => t.id === tareaId);
        if (index !== -1) {
            this._tareas.splice(index, 1);
            return true;
        }
        return false;
    }

    buscar(texto) {
        const textoLower = texto.toLowerCase();
        return this._tareas.filter(t => 
            t.titulo.toLowerCase().includes(textoLower) ||
            t.descripcion.toLowerCase().includes(textoLower)
        );
    }

    obtenerTodas() { return [...this._tareas]; }
    obtenerPendientes() { return this._tareas.filter(t => !t.completada); }
    obtenerCompletadas() { return this._tareas.filter(t => t.completada); }
    
    _obtenerPorId(tareaId) {
        return this._tareas.find(t => t.id === tareaId);
    }

    estadisticas() {
        const total = this._tareas.length;
        const completadas = this._tareas.filter(t => t.completada).length;
        return {
            total,
            completadas,
            pendientes: total - completadas,
            porcentajeCompletado: total > 0 ? (completadas / total * 100) : 0
        };
    }
}

class Backend {
    constructor() {
        this.gestor = new GestorTareas();
    }

    obtenerTareas(filtro = 'todas') {
        const filtros = {
            'todas': this.gestor.obtenerTodas.bind(this.gestor),
            'pendientes': this.gestor.obtenerPendientes.bind(this.gestor),
            'completadas': this.gestor.obtenerCompletadas.bind(this.gestor)
        };
        return (filtros[filtro] || filtros['todas'])();
    }

    crearTarea(titulo, descripcion = '') {
        return this.gestor.agregar(titulo, descripcion);
    }

    toggleTarea(tareaId) {
        return this.gestor.completar(tareaId);
    }

    borrarTarea(tareaId) {
        return this.gestor.eliminar(tareaId);
    }

    buscarTareas(texto) {
        return this.gestor.buscar(texto);
    }

    obtenerEstadisticas() {
        return this.gestor.estadisticas();
    }
}

module.exports = Backend;
```

**cli.js**
```javascript
#!/usr/bin/env node
/**
 * cli.js - Interfaz de l√≠nea de comandos
 * Consume la API del backend sin conocer implementaci√≥n interna
 */

const readline = require('readline');
const Backend = require('./backend');

class AplicacionTareas {
    constructor() {
        this.backend = new Backend();
        this.rl = readline.createInterface({
            input: process.stdin,
            output: process.stdout
        });
    }

    async iniciar() {
        console.log('\nüìã GESTOR DE TAREAS');
        await this._mostrarMenu();
    }

    async _mostrarMenu() {
        while (true) {
            console.log('\n' + '-'.repeat(40));
            console.log('1. Ver todas las tareas');
            console.log('2. Agregar tarea');
            console.log('3. Completar/Descompletar tarea');
            console.log('4. Eliminar tarea');
            console.log('5. Buscar tareas');
            console.log('6. Ver estad√≠sticas');
            console.log('0. Salir');
            
            const opcion = await this._pregunta('Selecciona una opci√≥n: ');
            
            switch (opcion) {
                case '1': await this._verTareas(); break;
                case '2': await this._agregarTarea(); break;
                case '3': await this._toggleTarea(); break;
                case '4': await this._eliminarTarea(); break;
                case '5': await this._buscarTareas(); break;
                case '6': await this._verEstadisticas(); break;
                case '0': 
                    this.rl.close();
                    return;
                default:
                    console.log('‚ùå Opci√≥n no v√°lida');
            }
        }
    }

    async _verTareas() {
        const tareas = this.backend.obtenerTareas();
        this._mostrarTareas(tareas);
    }

    async _agregarTarea() {
        const titulo = await this._pregunta('T√≠tulo: ');
        if (!titulo.trim()) {
            console.log('‚ùå El t√≠tulo es obligatorio');
            return;
        }
        const descripcion = await this._pregunta('Descripci√≥n (opcional): ');
        this.backend.crearTarea(titulo, descripcion);
        console.log('‚úÖ Tarea agregada');
    }

    async _toggleTarea() {
        const tareas = this.backend.obtenerTareas('pendientes');
        this._mostrarTareas(tareas);
        if (tareas.length === 0) return;
        
        const id = await this._pregunta('ID de la tarea a completar: ');
        if (this.backend.toggleTarea(parseInt(id))) {
            console.log('‚úÖ Estado actualizado');
        } else {
            console.log('‚ùå Tarea no encontrada');
        }
    }

    async _eliminarTarea() {
        const tareas = this.backend.obtenerTareas();
        this._mostrarTareas(tareas);
        if (tareas.length === 0) return;
        
        const id = await this._pregunta('ID de la tarea a eliminar: ');
        if (this.backend.borrarTarea(parseInt(id))) {
            console.log('‚úÖ Tarea eliminada');
        } else {
            console.log('‚ùå Tarea no encontrada');
        }
    }

    async _buscarTareas() {
        const texto = await this._pregunta('Texto a buscar: ');
        const tareas = this.backend.buscarTareas(texto);
        this._mostrarTareas(tareas);
    }

    async _verEstadisticas() {
        const stats = this.backend.obtenerEstadisticas();
        console.log('\nüìä ESTAD√çSTICAS');
        console.log(`Total: ${stats.total}`);
        console.log(`‚úÖ Completadas: ${stats.completadas}`);
        console.log(`‚è≥ Pendientes: ${stats.pendientes}`);
        console.log(`Porcentaje: ${stats.porcentajeCompletado.toFixed(1)}%`);
    }

    _mostrarTareas(tareas) {
        if (tareas.length === 0) {
            console.log('No hay tareas');
            return;
        }
        console.log('\n' + '-'.repeat(60));
        console.log('ID'.padEnd(4) + 'ESTADO'.padEnd(12) + 'T√çTULO');
        tareas.forEach(t => {
            const estado = t.completada ? '‚úÖ COMPLETADA' : '‚è≥ PENDIENTE';
            console.log(`${t.id.toString().padEnd(4)} ${estado.padEnd(12)} ${t.titulo}`);
            if (t.descripcion) {
                console.log(`    üìù ${t.descripcion}`);
            }
        });
    }

    _pregunta(query) {
        return new Promise(resolve => this.rl.question(query, resolve));
    }
}

if (require.main === module) {
    const app = new AplicacionTareas();
    app.iniciar().catch(console.error);
}
```

### package.json
```json
{
  "name": "gestor-tareas",
  "version": "1.0.0",
  "description": "Gestor de tareas con separaci√≥n backend/frontend",
  "main": "cli.js",
  "scripts": {
    "start": "node cli.js"
  },
  "bin": {
    "tareas": "./cli.js"
  }
}
```

### Estructura

```
proyecto/
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend.js
‚îî‚îÄ‚îÄ cli.js
```

---

## Nivel 3 ‚Äî Patr√≥n AUDI
Arquitectura por capas fundamentales.

### Cu√°ndo escalar al Nivel 4
Escalar cuando el equipo necesite pruebas automatizadas, cuando haya scripts de migraci√≥n o seed data recurrentes, o cuando la documentaci√≥n interna se vuelva necesaria para onboarding.

### Diagrama de Dependencias

```
User_Interface
      ‚îÇ
      ‚ñº
 Application  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                          ‚îÇ
      ‚ñº                          ‚îÇ
   Domain               Infrastructure
  (n√∫cleo puro,            (I/O, DB, APIs)
 sin dependencias)
```

### Asincron√≠a en AUDI

```javascript
// Infrastructure ‚Äî async para I/O
class RepositorioUsuarioSQL {
    async obtenerPorId(id) {
        const db = await this._getConnection();
        return db.get('SELECT * FROM usuarios WHERE id = ?', id);
    }
}

// Application ‚Äî propaga async seg√∫n necesidad
class ServicioUsuario {
    async obtenerUsuario(id) {
        const usuario = await this.repositorio.obtenerPorId(id);
        return UsuarioDTO.desdeEntidad(usuario);
    }
}

// Domain ‚Äî siempre sync (l√≥gica pura, sin I/O)
class Usuario {
    aplicarDescuento(porcentaje) {
        if (porcentaje < 0 || porcentaje > 100) {
            throw new Error(`Descuento inv√°lido: ${porcentaje}`);
        }
        return this.precio * (1 - porcentaje / 100);
    }
}
```

### Ejemplo: Sistema de Reservas con Capas AUDI

**package.json**
```json
{
  "name": "sistema-reservas",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node bootstrap.js",
    "dev": "node --watch bootstrap.js"
  },
  "dependencies": {
    "better-sqlite3": "^9.0.0",
    "dotenv": "^16.0.0",
    "winston": "^3.8.0"
  },
  "devDependencies": {
    "jest": "^29.0.0"
  }
}
```

**Domain/entidades/reserva.js**
```javascript
// Domain/entidades/reserva.js - Entidades y reglas de negocio

export const EstadoReserva = {
    PENDIENTE: 'pendiente',
    CONFIRMADA: 'confirmada',
    CANCELADA: 'cancelada',
    COMPLETADA: 'completada'
};

export const TipoHabitacion = {
    INDIVIDUAL: 'individual',
    DOBLE: 'doble',
    SUITE: 'suite'
};

export class Cliente {
    constructor(id, nombre, email, telefono) {
        this.id = id;
        this.nombre = nombre;
        this.email = email;
        this.telefono = telefono;
    }

    validarEmail() {
        return this.email.includes('@') && this.email.includes('.');
    }

    validarTelefono() {
        return this.telefono.length >= 9 && /^\d+$/.test(this.telefono);
    }
}

export class Habitacion {
    constructor(id, numero, tipo, precioNoche, disponible = true) {
        this.id = id;
        this.numero = numero;
        this.tipo = tipo;
        this.precioNoche = precioNoche;
        this.disponible = disponible;
    }

    calcularPrecio(noches) {
        let precioBase = this.precioNoche * noches;
        if (noches > 7) {
            precioBase *= 0.9; // 10% descuento por estancia larga
        }
        return precioBase;
    }
}

export class Reserva {
    constructor(id, clienteId, habitacionId, fechaInicio, fechaFin, 
                estado = EstadoReserva.PENDIENTE, fechaCreacion = null) {
        this.id = id;
        this.clienteId = clienteId;
        this.habitacionId = habitacionId;
        this.fechaInicio = new Date(fechaInicio);
        this.fechaFin = new Date(fechaFin);
        this.estado = estado;
        this.fechaCreacion = fechaCreacion || new Date();
    }

    get noches() {
        const diff = this.fechaFin - this.fechaInicio;
        return Math.ceil(diff / (1000 * 60 * 60 * 24));
    }

    confirmar() {
        if (this.estado !== EstadoReserva.PENDIENTE) {
            throw new Error('Solo se pueden confirmar reservas pendientes');
        }
        this.estado = EstadoReserva.CONFIRMADA;
    }

    cancelar() {
        if (this.estado === EstadoReserva.COMPLETADA) {
            throw new Error('No se puede cancelar una reserva completada');
        }
        this.estado = EstadoReserva.CANCELADA;
    }

    solapaCon(otra) {
        return !(this.fechaFin <= otra.fechaInicio || this.fechaInicio >= otra.fechaFin);
    }
}
```

**Domain/excepciones/excepcionesDominio.js**
```javascript
// Domain/excepciones/excepcionesDominio.js

export class ErrorDominio extends Error {
    constructor(message) {
        super(message);
        this.name = 'ErrorDominio';
    }
}

export class ClienteNoEncontrado extends ErrorDominio {
    constructor(clienteId) {
        super(`Cliente con ID ${clienteId} no encontrado`);
        this.name = 'ClienteNoEncontrado';
    }
}

export class HabitacionNoDisponible extends ErrorDominio {
    constructor(habitacionId, fechaInicio, fechaFin) {
        super(`Habitaci√≥n ${habitacionId} no disponible entre ${fechaInicio} y ${fechaFin}`);
        this.name = 'HabitacionNoDisponible';
    }
}

export class FechasInvalidas extends ErrorDominio {
    constructor() {
        super('La fecha de fin debe ser posterior a la fecha de inicio');
        this.name = 'FechasInvalidas';
    }
}
```

**Application/interfaces/repositorios.js**
```javascript
// Application/interfaces/repositorios.js

export class RepositorioCliente {
    async obtenerPorId(clienteId) { throw new Error('Not implemented'); }
    async guardar(cliente) { throw new Error('Not implemented'); }
    async listar() { throw new Error('Not implemented'); }
}

export class RepositorioHabitacion {
    async obtenerPorId(habitacionId) { throw new Error('Not implemented'); }
    async listarDisponibles(fechaInicio, fechaFin) { throw new Error('Not implemented'); }
    async guardar(habitacion) { throw new Error('Not implemented'); }
}

export class RepositorioReserva {
    async obtenerPorId(reservaId) { throw new Error('Not implemented'); }
    async obtenerPorHabitacion(habitacionId, fechaInicio, fechaFin) { throw new Error('Not implemented'); }
    async guardar(reserva) { throw new Error('Not implemented'); }
    async actualizarEstado(reservaId, nuevoEstado) { throw new Error('Not implemented'); }
}
```

**Application/dto/reservaDto.js**
```javascript
// Application/dto/reservaDto.js

export class SolicitudReservaDTO {
    constructor(clienteId, habitacionId, fechaInicio, fechaFin) {
        this.clienteId = clienteId;
        this.habitacionId = habitacionId;
        this.fechaInicio = new Date(fechaInicio);
        this.fechaFin = new Date(fechaFin);
    }

    static desdeDict(data) {
        return new SolicitudReservaDTO(
            data.clienteId,
            data.habitacionId,
            data.fechaInicio,
            data.fechaFin
        );
    }
}

export class ReservaDTO {
    constructor(id, cliente, habitacion, fechaInicio, fechaFin, estado, noches, precioTotal) {
        this.id = id;
        this.cliente = cliente;
        this.habitacion = habitacion;
        this.fechaInicio = fechaInicio;
        this.fechaFin = fechaFin;
        this.estado = estado;
        this.noches = noches;
        this.precioTotal = precioTotal;
    }

    static desdeEntidad(reserva, cliente, habitacion) {
        return new ReservaDTO(
            reserva.id,
            { id: cliente.id, nombre: cliente.nombre, email: cliente.email },
            { id: habitacion.id, numero: habitacion.numero, tipo: habitacion.tipo },
            reserva.fechaInicio,
            reserva.fechaFin,
            reserva.estado,
            reserva.noches,
            habitacion.calcularPrecio(reserva.noches)
        );
    }

    toJSON() {
        return {
            id: this.id,
            cliente: this.cliente,
            habitacion: this.habitacion,
            fechaInicio: this.fechaInicio.toISOString(),
            fechaFin: this.fechaFin.toISOString(),
            estado: this.estado,
            noches: this.noches,
            precioTotal: this.precioTotal
        };
    }
}
```

**Application/servicios/servicioReserva.js**
```javascript
// Application/servicios/servicioReserva.js

import { ClienteNoEncontrado, HabitacionNoDisponible, FechasInvalidas } from '../../Domain/excepciones/excepcionesDominio.js';
import { Reserva, EstadoReserva } from '../../Domain/entidades/reserva.js';
import { ReservaDTO } from '../dto/reservaDto.js';
import { createLogger } from '../../Infrastructure/logging/loggerConfig.js';

export class ServicioReserva {
    constructor(repoCliente, repoHabitacion, repoReserva) {
        this.repoCliente = repoCliente;
        this.repoHabitacion = repoHabitacion;
        this.repoReserva = repoReserva;
        this.logger = createLogger('ServicioReserva');
    }

    async crearReserva(solicitud) {
        this.logger.info(`Creando reserva para cliente ${solicitud.clienteId}`);

        if (solicitud.fechaFin <= solicitud.fechaInicio) {
            throw new FechasInvalidas();
        }

        const cliente = await this.repoCliente.obtenerPorId(solicitud.clienteId);
        if (!cliente) {
            throw new ClienteNoEncontrado(solicitud.clienteId);
        }

        const reservasExistentes = await this.repoReserva.obtenerPorHabitacion(
            solicitud.habitacionId,
            solicitud.fechaInicio,
            solicitud.fechaFin
        );

        if (reservasExistentes.length > 0) {
            throw new HabitacionNoDisponible(
                solicitud.habitacionId,
                solicitud.fechaInicio,
                solicitud.fechaFin
            );
        }

        const habitacion = await this.repoHabitacion.obtenerPorId(solicitud.habitacionId);
        
        const reserva = new Reserva(
            null,
            cliente.id,
            habitacion.id,
            solicitud.fechaInicio,
            solicitud.fechaFin,
            EstadoReserva.PENDIENTE
        );

        const reservaGuardada = await this.repoReserva.guardar(reserva);
        this.logger.info(`Reserva creada con ID ${reservaGuardada.id}`);
        
        return ReservaDTO.desdeEntidad(reservaGuardada, cliente, habitacion);
    }

    async confirmarReserva(reservaId) {
        const reserva = await this.repoReserva.obtenerPorId(reservaId);
        if (!reserva) {
            throw new Error(`Reserva ${reservaId} no encontrada`);
        }

        reserva.confirmar();
        await this.repoReserva.actualizarEstado(reservaId, reserva.estado);
        
        const cliente = await this.repoCliente.obtenerPorId(reserva.clienteId);
        const habitacion = await this.repoHabitacion.obtenerPorId(reserva.habitacionId);
        
        return ReservaDTO.desdeEntidad(reserva, cliente, habitacion);
    }
}
```

**Infrastructure/persistencia/repositoriosSQL.js**
```javascript
// Infrastructure/persistencia/repositoriosSQL.js

import Database from 'better-sqlite3';
import { Cliente, Habitacion, Reserva, EstadoReserva, TipoHabitacion } from '../../Domain/entidades/reserva.js';
import { RepositorioCliente, RepositorioReserva } from '../../Application/interfaces/repositorios.js';

export class RepositorioClienteSQL extends RepositorioCliente {
    constructor(dbPath) {
        super();
        this.db = new Database(dbPath);
        this._crearTabla();
    }

    _crearTabla() {
        this.db.exec(`
            CREATE TABLE IF NOT EXISTS clientes (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                nombre TEXT NOT NULL,
                email TEXT UNIQUE NOT NULL,
                telefono TEXT
            )
        `);
    }

    async obtenerPorId(clienteId) {
        const stmt = this.db.prepare('SELECT id, nombre, email, telefono FROM clientes WHERE id = ?');
        const row = stmt.get(clienteId);
        if (row) {
            return new Cliente(row.id, row.nombre, row.email, row.telefono || '');
        }
        return null;
    }

    async guardar(cliente) {
        const stmt = this.db.prepare(
            'INSERT INTO clientes (nombre, email, telefono) VALUES (?, ?, ?)'
        );
        const info = stmt.run(cliente.nombre, cliente.email, cliente.telefono);
        cliente.id = info.lastInsertRowid;
        return cliente;
    }

    async listar() {
        const stmt = this.db.prepare('SELECT id, nombre, email, telefono FROM clientes');
        const rows = stmt.all();
        return rows.map(r => new Cliente(r.id, r.nombre, r.email, r.telefono || ''));
    }
}

export class RepositorioReservaSQL extends RepositorioReserva {
    constructor(dbPath) {
        super();
        this.db = new Database(dbPath);
        this._crearTabla();
    }

    _crearTabla() {
        this.db.exec(`
            CREATE TABLE IF NOT EXISTS reservas (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                cliente_id INTEGER NOT NULL,
                habitacion_id INTEGER NOT NULL,
                fecha_inicio TEXT NOT NULL,
                fecha_fin TEXT NOT NULL,
                estado TEXT NOT NULL,
                fecha_creacion TEXT
            )
        `);
    }

    async obtenerPorHabitacion(habitacionId, fechaInicio, fechaFin) {
        const stmt = this.db.prepare(`
            SELECT id, cliente_id, habitacion_id, fecha_inicio, fecha_fin, estado, fecha_creacion
            FROM reservas 
            WHERE habitacion_id = ?
            AND estado IN ('pendiente', 'confirmada')
            AND NOT (fecha_fin <= ? OR fecha_inicio >= ?)
        `);
        
        const rows = stmt.all(
            habitacionId,
            fechaInicio.toISOString(),
            fechaFin.toISOString()
        );

        return rows.map(r => new Reserva(
            r.id,
            r.cliente_id,
            r.habitacion_id,
            new Date(r.fecha_inicio),
            new Date(r.fecha_fin),
            r.estado,
            r.fecha_creacion ? new Date(r.fecha_creacion) : null
        ));
    }

    async guardar(reserva) {
        const stmt = this.db.prepare(
            'INSERT INTO reservas (cliente_id, habitacion_id, fecha_inicio, fecha_fin, estado) VALUES (?, ?, ?, ?, ?)'
        );
        const info = stmt.run(
            reserva.clienteId,
            reserva.habitacionId,
            reserva.fechaInicio.toISOString(),
            reserva.fechaFin.toISOString(),
            reserva.estado
        );
        reserva.id = info.lastInsertRowid;
        return reserva;
    }

    async actualizarEstado(reservaId, nuevoEstado) {
        const stmt = this.db.prepare('UPDATE reservas SET estado = ? WHERE id = ?');
        const info = stmt.run(nuevoEstado, reservaId);
        return info.changes > 0;
    }

    async obtenerPorId(reservaId) {
        const stmt = this.db.prepare(
            'SELECT id, cliente_id, habitacion_id, fecha_inicio, fecha_fin, estado FROM reservas WHERE id = ?'
        );
        const r = stmt.get(reservaId);
        if (r) {
            return new Reserva(
                r.id,
                r.cliente_id,
                r.habitacion_id,
                new Date(r.fecha_inicio),
                new Date(r.fecha_fin),
                r.estado
            );
        }
        return null;
    }
}
```

### Estructura

```
proyecto/
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend.js
‚îú‚îÄ‚îÄ bootstrap.js
‚îÇ
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ servicios/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ servicioReserva.js
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservaDto.js
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/
‚îÇ       ‚îî‚îÄ‚îÄ repositorios.js
‚îÇ
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ entidades/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reserva.js
‚îÇ   ‚îî‚îÄ‚îÄ excepciones/
‚îÇ       ‚îî‚îÄ‚îÄ excepcionesDominio.js
‚îÇ
‚îú‚îÄ‚îÄ Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ persistencia/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositoriosSQL.js
‚îÇ   ‚îî‚îÄ‚îÄ logging/
‚îÇ       ‚îî‚îÄ‚îÄ loggerConfig.js
‚îÇ
‚îî‚îÄ‚îÄ User_Interface/
    ‚îú‚îÄ‚îÄ cli.js
    ‚îî‚îÄ‚îÄ vistas/
```

---

## Nivel 4 ‚Äî Patr√≥n AUDDITS
Extensi√≥n productiva con testing, scripts y documentaci√≥n.

### Cu√°ndo escalar al Nivel 5
Escalar cuando la UI se vuelva compleja con m√∫ltiples vistas y estado compartido, cuando los ViewModels necesiten ser testeables sin levantar la interfaz, o cuando se prevea reutilizar la l√≥gica de presentaci√≥n en m√∫ltiples frameworks.

### Reglas de Desarrollo

**Regla #1 ‚Äî Responsabilidad √önica**
- Cada archivo tiene una √∫nica responsabilidad bien definida.
- Cada clase tiene una sola raz√≥n para cambiar.
- Cada funci√≥n hace una sola cosa y la hace correctamente.

```javascript
// ‚ùå MAL ‚Äî tres responsabilidades en un m√©todo
class ServicioUsuario {
    async registrar(datos) {
        if (!datos.email) throw new Error();   // validaci√≥n
        await this.db.guardar(datos);           // persistencia
        await this.email.enviarBienvenida();    // notificaci√≥n
    }
}

// ‚úÖ BIEN ‚Äî cada responsabilidad en su lugar
class ServicioRegistro {
    async registrar(dto) {
        const usuario = this.validador.validar(dto);
        await this.repositorio.guardar(usuario);
        this.eventEmitter.emit('usuario.registrado', usuario.id);
        return usuario;
    }
}
```

**Regla #2 ‚Äî Dependencias Direccionales**
- Domain no depende de ninguna otra capa.
- Application solo depende de Domain.
- Infrastructure puede depender de Application y Domain.
- User_Interface depende de Application, nunca directamente de Infrastructure.

```javascript
// Domain/entidades/usuario.js ‚Äî No importa nada externo
export class Usuario {
    constructor(nombre, email) {
        this.nombre = nombre;
        this.email = email;
    }
}

// Application/servicios/servicioUsuario.js ‚Äî Solo importa Domain
import { Usuario } from '../../Domain/entidades/usuario.js';
import { RepositorioUsuario } from '../interfaces/repositorioUsuario.js';

// Infrastructure/persistencia/repositorioUsuarioSQL.js ‚Äî Implementa contratos
import { Usuario } from '../../Domain/entidades/usuario.js';
import { RepositorioUsuario } from '../../Application/interfaces/repositorioUsuario.js';

// User_Interface/cli.js ‚Äî Consume Application
import { Backend } from '../backend.js';
```

**Regla #3 ‚Äî Nomenclatura**
- Clases ‚Üí PascalCase.
- M√©todos y variables ‚Üí camelCase.
- Constantes ‚Üí UPPER_SNAKE_CASE.
- Archivos ‚Üí kebab-case.js o camelCase.js (consistente).

**Regla #4 ‚Äî Importaciones Correctas**
```javascript
// ‚úÖ Correcto
import { Usuario } from '../Domain/entidades/usuario.js';
import { ServicioUsuario } from './servicios/servicioUsuario.js';
import { RepositorioUsuarioSQL } from '../Infrastructure/persistencia/repositorioUsuarioSQL.js';

// ‚ùå Evitar
import * as Domain from '../Domain';
import ServicioUsuario from './servicios';
```

**Regla #5 ‚Äî Manejo de Errores**
- Excepciones de negocio en Domain/excepciones/.
- Excepciones t√©cnicas en Infrastructure.
- La UI solo expone mensajes amigables.

**Regla #6 ‚Äî Inyecci√≥n de Dependencias**
```javascript
// ‚úÖ BIEN ‚Äî dependencia inyectada, testeable
class ServicioUsuario {
    constructor(repositorio) {
        this.repositorio = repositorio;
    }
}

// ‚ùå MAL ‚Äî dependencia oculta, imposible de mockear
class ServicioUsuario {
    constructor() {
        this.repositorio = new RepositorioUsuarioSQL(); // acoplado al proveedor concreto
    }
}
```

**Regla #7 ‚Äî DTOs vs Entidades**
- Las entidades de dominio no se exponen directamente a la UI.
- Los DTOs transportan datos entre capas.
- Las entidades contienen l√≥gica; los DTOs solo estructura.

```javascript
// Domain ‚Äî con l√≥gica de negocio
export class Usuario {
    cambiarPassword(passwordNueva) {
        if (passwordNueva.length < 8) {
            throw new Error('Password demasiado corto');
        }
        this._passwordHash = hash(passwordNueva);
        this._intentosFallidos = 0;
    }
}

// Application ‚Äî solo datos, sin l√≥gica
export class UsuarioDTO {
    constructor(id, nombre, email, estaBloqueado) {
        this.id = id;
        this.nombre = nombre;
        this.email = email;
        this.estaBloqueado = estaBloqueado;
    }

    static desdeEntidad(usuario) {
        return new UsuarioDTO(
            usuario.id,
            usuario.nombre,
            usuario.email,
            usuario.estaBloqueado
        );
    }

    toJSON() {
        return {
            id: this.id,
            nombre: this.nombre,
            email: this.email,
            bloqueado: this.estaBloqueado
        };
    }
}
```

**Regla #8 ‚Äî backend.js como Adaptador**
```javascript
// backend.js
import { createLogger } from './Infrastructure/logging/loggerConfig.js';
import { RepositorioUsuarioSQL } from './Infrastructure/persistencia/repositoriosSQL.js';
import { ServicioUsuario } from './Application/servicios/servicioUsuario.js';
import { UsuarioDTO } from './Application/dto/usuarioDto.js';

export class Backend {
    constructor(config = {}) {
        this.config = config;
        this.logger = createLogger('Backend');
        this._inicializarServicios();
    }

    _inicializarServicios() {
        this.repositorioUsuario = new RepositorioUsuarioSQL(
            this.config.dbPath || 'data/dev.db'
        );
        this.servicioUsuario = new ServicioUsuario(this.repositorioUsuario);
    }

    async obtenerUsuarios(filtros = null) {
        try {
            const usuarios = await this.servicioUsuario.listar(filtros);
            return usuarios.map(u => UsuarioDTO.desdeEntidad(u));
        } catch (error) {
            this.logger.error(`Error obteniendo usuarios: ${error.message}`);
            return [];
        }
    }

    async crearUsuario(datos) {
        try {
            const usuario = await this.servicioUsuario.crear(datos);
            return UsuarioDTO.desdeEntidad(usuario);
        } catch (error) {
            this.logger.error(`Error creando usuario: ${error.message}`);
            throw error;
        }
    }

    cerrar() {
        if (this.repositorioUsuario && this.repositorioUsuario.cerrar) {
            this.repositorioUsuario.cerrar();
        }
    }
}
```

**Regla #9 ‚Äî bootstrap.js como Orquestador**
```javascript
// bootstrap.js
#!/usr/bin/env node

import dotenv from 'dotenv';
import path from 'path';
import { fileURLToPath } from 'url';
import { Backend } from './backend.js';
import { createLogger } from './Infrastructure/logging/loggerConfig.js';
import { CLI } from './User_Interface/cli.js';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

class Application {
    constructor() {
        this.backend = null;
        this.logger = null;
        this._cargarConfiguracion();
    }

    _cargarConfiguracion() {
        dotenv.config({ path: path.join(__dirname, '.env') });
    }

    inicializar(modo = 'desarrollo') {
        const config = {
            desarrollo: { dbPath: 'data/dev.db', logLevel: 'debug' },
            produccion: { dbPath: process.env.DB_PATH, logLevel: 'info' },
            test: { dbPath: ':memory:', logLevel: 'error' }
        }[modo] || {};

        this.logger = createLogger('Bootstrap', config.logLevel);
        this.backend = new Backend(config);
        this.logger.info(`Aplicaci√≥n inicializada en modo: ${modo}`);
    }

    async ejecutar() {
        const cli = new CLI(this.backend);
        await cli.iniciar();
    }

    cerrar() {
        if (this.backend) {
            this.backend.cerrar();
        }
    }
}

async function main() {
    const app = new Application();
    const modo = process.argv.includes('--prod') ? 'produccion' : 'desarrollo';
    
    try {
        app.inicializar(modo);
        await app.ejecutar();
    } catch (error) {
        console.error('Error fatal:', error);
        process.exit(1);
    } finally {
        app.cerrar();
    }
}

if (import.meta.url === `file://${process.argv[1]}`) {
    main();
}

export { Application };
```

**Regla #10 ‚Äî Pruebas con Jest**

```javascript
// Tests/test_domain/usuario.test.js
import { Usuario } from '../../Domain/entidades/usuario.js';

describe('Usuario', () => {
    let usuario;

    beforeEach(() => {
        usuario = new Usuario(1, 'Juan P√©rez', 'juan@example.com');
    });

    test('debe crear usuario v√°lido', () => {
        expect(usuario.nombre).toBe('Juan P√©rez');
        expect(usuario.activo).toBe(true);
    });

    test('debe lanzar error con email inv√°lido', () => {
        expect(() => {
            usuario.cambiarEmail('email-invalido');
        }).toThrow('Email inv√°lido');
    });

    test('debe desactivar usuario', () => {
        usuario.desactivar();
        expect(usuario.activo).toBe(false);
    });
});

// Tests/test_application/servicioUsuario.test.js
import { ServicioUsuario } from '../../Application/servicios/servicioUsuario.js';

describe('ServicioUsuario', () => {
    let servicio;
    let mockRepositorio;

    beforeEach(() => {
        mockRepositorio = {
            guardar: jest.fn(),
            obtenerPorId: jest.fn()
        };
        servicio = new ServicioUsuario(mockRepositorio);
    });

    test('debe crear usuario exitosamente', async () => {
        const datos = { nombre: 'Test', email: 'test@example.com' };
        mockRepositorio.guardar.mockResolvedValue({ id: 1, ...datos });

        const resultado = await servicio.crear(datos);

        expect(resultado.id).toBe(1);
        expect(mockRepositorio.guardar).toHaveBeenCalled();
    });
});

// Tests/test_infrastructure/repositorios.test.js
import Database from 'better-sqlite3';
import { RepositorioUsuarioSQL } from '../../Infrastructure/persistencia/repositoriosSQL.js';
import { Usuario } from '../../Domain/entidades/usuario.js';

describe('RepositorioUsuarioSQL', () => {
    let db;
    let repositorio;

    beforeEach(() => {
        db = new Database(':memory:');
        repositorio = new RepositorioUsuarioSQL(':memory:');
    });

    afterEach(() => {
        db.close();
    });

    test('debe guardar y recuperar usuario', async () => {
        const usuario = new Usuario(null, 'Test', 'test@example.com');
        const guardado = await repositorio.guardar(usuario);

        expect(guardado.id).toBeDefined();

        const recuperado = await repositorio.obtenerPorId(guardado.id);
        expect(recuperado.nombre).toBe('Test');
    });
});
```

**package.json para testing**
```json
{
  "scripts": {
    "test": "NODE_OPTIONS=--experimental-vm-modules jest",
    "test:watch": "NODE_OPTIONS=--experimental-vm-modules jest --watch",
    "test:coverage": "NODE_OPTIONS=--experimental-vm-modules jest --coverage",
    "lint": "eslint .",
    "format": "prettier --write ."
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "@types/jest": "^29.0.0",
    "eslint": "^8.0.0",
    "prettier": "^3.0.0"
  },
  "jest": {
    "transform": {},
    "testEnvironment": "node",
    "testMatch": ["**/Tests/**/*.test.js"],
    "collectCoverageFrom": [
      "Application/**/*.js",
      "Domain/**/*.js",
      "Infrastructure/**/*.js"
    ]
  }
}
```

**Regla #11 ‚Äî Documentaci√≥n con JSDoc**
```javascript
/**
 * Procesa un pago para un usuario espec√≠fico.
 * 
 * @param {Object} params - Par√°metros del pago
 * @param {number} params.usuarioId - Identificador √∫nico del usuario
 * @param {number} params.monto - Cantidad a cobrar (mayor a 0, menor a 10000)
 * @param {string} params.metodoPago - 'tarjeta', 'transferencia' o 'efectivo'
 * @param {string} [params.tokenTarjeta] - Token requerido solo para m√©todo 'tarjeta'
 * @returns {Promise<Object>} Resultado con campos: exitoso, transaccionId, mensaje
 * @throws {UsuarioNoEncontrado} Si el usuarioId no existe
 * @throws {PagoRechazado} Si la pasarela rechaza la transacci√≥n
 * 
 * @example
 * const resultado = await procesarPago({
 *   usuarioId: 123,
 *   monto: 99.99,
 *   metodoPago: 'tarjeta',
 *   tokenTarjeta: 'tok_visa_123'
 * });
 * if (resultado.exitoso) {
 *   console.log(resultado.transaccionId);
 * }
 */
async function procesarPago({ usuarioId, monto, metodoPago, tokenTarjeta }) {
    // implementaci√≥n
}
```

**Regla #12 ‚Äî Git Workflow**
- main ‚Üí Producci√≥n.
- develop ‚Üí Integraci√≥n.
- feature/* ‚Üí Nuevas funcionalidades.
- hotfix/* ‚Üí Correcciones urgentes.
- release/* ‚Üí Preparaci√≥n de versiones.

```bash
# Convenciones de commits: tipo(alcance): descripci√≥n
feat(usuarios): a√±adir b√∫squeda por email
fix(pagos): corregir c√°lculo de impuestos
docs(api): actualizar documentaci√≥n de endpoints
test(usuarios): a√±adir pruebas para registro
refactor(backend): simplificar inyecci√≥n de dependencias
```

### Estructura

```
proyecto/
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend.js
‚îú‚îÄ‚îÄ bootstrap.js
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .eslintrc.json
‚îú‚îÄ‚îÄ .prettierrc
‚îÇ
‚îú‚îÄ‚îÄ Application/
‚îú‚îÄ‚îÄ Domain/
‚îú‚îÄ‚îÄ Infrastructure/
‚îú‚îÄ‚îÄ User_Interface/
‚îÇ
‚îú‚îÄ‚îÄ Tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_domain/
‚îÇ   ‚îú‚îÄ‚îÄ test_application/
‚îÇ   ‚îî‚îÄ‚îÄ test_infrastructure/
‚îÇ
‚îú‚îÄ‚îÄ Scripts/
‚îÇ   ‚îú‚îÄ‚îÄ migraciones.js
‚îÇ   ‚îî‚îÄ‚îÄ seed.js
‚îÇ
‚îî‚îÄ‚îÄ Docs/
    ‚îú‚îÄ‚îÄ README.md
    ‚îî‚îÄ‚îÄ arquitectura.md
```

---

## Nivel 5 ‚Äî Patr√≥n AUDDITS + MVVM
Extensi√≥n completa con separaci√≥n de presentaci√≥n mediante MVVM.

### Cu√°ndo NO usar MVVM
MVVM agrega overhead real. No est√° justificado cuando:
- La UI tiene una sola vista sin estado complejo.
- El proyecto es interno o de vida corta.
- El equipo no tiene experiencia con el patr√≥n.
- No hay necesidad de testear la l√≥gica de presentaci√≥n por separado.

### Reglas MVVM

**Regla #13 ‚Äî Separaci√≥n MVVM**
Vista ‚Üí ViewModel ‚Üí Modelo.
- La Vista contiene solo widgets y l√≥gica de presentaci√≥n.
- El ViewModel contiene estado observable y l√≥gica de UI.
- El Modelo contiene datos (UI o negocio seg√∫n capa).
- La Vista nunca accede directamente a Domain o Infrastructure.

```javascript
// Vista (User_Interface) ‚Äî solo widgets y binding
class VistaUsuarios {
    constructor(parent, viewmodel) {
        this.viewmodel = viewmodel;
        this.viewmodel.suscribir(this._onCambio.bind(this));
        this._crearWidgets();
    }

    _onCambio(evento) {
        if (evento.nombre === 'usuarios') {
            this._actualizarTabla();
        }
    }
}

// ViewModel (Presentation) ‚Äî estado y l√≥gica de UI
class UsuarioViewModel extends ViewModelBase {
    async cargarUsuarios() {
        this._usuarios = await this.backend.obtenerUsuarios();
        this.notificarCambio('usuarios');
    }
}
```

**Regla #14 ‚Äî ViewModelBase obligatorio**
```javascript
// Presentation/viewmodels/viewmodelBase.js
import EventEmitter from 'events';

export class ViewModelBase extends EventEmitter {
    constructor() {
        super();
        this._propiedades = new Map();
        this._errores = new Map();
        this._ocupado = false;
        this._mensajeEstado = '';
    }

    notificarCambio(nombre, valorAnterior = null) {
        const evento = {
            nombre,
            valorAnterior,
            valorNuevo: this._propiedades.get(nombre)
        };
        this.emit('cambio', evento);
    }

    establecerPropiedad(nombre, valor) {
        const valorAnterior = this._propiedades.get(nombre);
        if (valorAnterior !== valor) {
            this._propiedades.set(nombre, valor);
            this.notificarCambio(nombre, valorAnterior);
            return true;
        }
        return false;
    }

    get ocupado() { return this._ocupado; }
    set ocupado(valor) { this.establecerPropiedad('_ocupado', valor); }

    get mensajeEstado() { return this._mensajeEstado; }
    set mensajeEstado(msg) { this.establecerPropiedad('_mensajeEstado', msg); }

    agregarError(propiedad, mensaje) {
        this._errores.set(propiedad, mensaje);
        this.notificarCambio(`error_${propiedad}`);
    }

    limpiarErrores() {
        this._errores.clear();
    }
}
```

**Regla #15 ‚Äî Modelos de UI**
```javascript
// Presentation/models/uiUsuario.js
export class UIUsuario {
    constructor(id = null, nombre = '', email = '', activo = true) {
        this.id = id;
        this.nombre = nombre;
        this.email = email;
        this.activo = activo;
        this.seleccionado = false;
        this.editando = false;
    }

    validarFormato() {
        const errores = {};
        if (this.nombre && this.nombre.trim().length < 3) {
            errores.nombre = 'M√≠nimo 3 caracteres';
        }
        if (this.email && !/^[^@]+@[^@]+\.[^@]+$/.test(this.email)) {
            errores.email = 'Formato email inv√°lido';
        }
        return errores;
    }

    toJSON() {
        return {
            id: this.id,
            nombre: this.nombre,
            email: this.email,
            activo: this.activo
        };
    }

    static fromDTO(dto) {
        return new UIUsuario(dto.id, dto.nombre, dto.email, dto.activo);
    }
}
```

**Regla #16 ‚Äî ViewModels Espec√≠ficos**
```javascript
// Presentation/viewmodels/usuarioViewModel.js
import { ViewModelBase } from './viewmodelBase.js';
import { UIUsuario } from '../models/uiUsuario.js';

export class UsuarioViewModel extends ViewModelBase {
    constructor(backend) {
        super();
        this.backend = backend;
        this._usuarios = [];
        this._usuarioSeleccionado = null;
        this._filtroNombre = '';
        this.cargarUsuarios();
    }

    get usuarios() {
        if (!this._filtroNombre) return this._usuarios;
        const filtro = this._filtroNombre.toLowerCase();
        return this._usuarios.filter(u => 
            u.nombre.toLowerCase().includes(filtro)
        );
    }

    get filtroNombre() { return this._filtroNombre; }
    set filtroNombre(valor) {
        this.establecerPropiedad('_filtroNombre', valor);
        this.notificarCambio('usuarios');
    }

    async cargarUsuarios() {
        this.ocupado = true;
        this.mensajeEstado = 'Cargando usuarios...';
        
        try {
            const dtos = await this.backend.obtenerUsuarios();
            this._usuarios = dtos.map(dto => UIUsuario.fromDTO(dto));
            this.mensajeEstado = `${this._usuarios.length} usuarios cargados`;
            this.notificarCambio('usuarios');
        } catch (error) {
            this.mensajeEstado = `Error: ${error.message}`;
        } finally {
            this.ocupado = false;
        }
    }

    async guardarActual() {
        if (!this._usuarioSeleccionado) return false;

        const errores = this._usuarioSeleccionado.validarFormato();
        if (Object.keys(errores).length > 0) {
            Object.entries(errores).forEach(([campo, msg]) => {
                this.agregarError(campo, msg);
            });
            return false;
        }

        this.ocupado = true;
        try {
            if (this._usuarioSeleccionado.id) {
                await this.backend.actualizarUsuario(
                    this._usuarioSeleccionado.id,
                    this._usuarioSeleccionado.toJSON()
                );
            } else {
                const dto = await this.backend.crearUsuario(
                    this._usuarioSeleccionado.toJSON()
                );
                this._usuarioSeleccionado.id = dto.id;
            }
            this.mensajeEstado = 'Guardado correctamente';
            await this.cargarUsuarios();
            return true;
        } catch (error) {
            this.mensajeEstado = `Error: ${error.message}`;
            return false;
        } finally {
            this.ocupado = false;
        }
    }

    seleccionarUsuario(usuario) {
        this._usuarioSeleccionado = usuario;
        this.notificarCambio('usuarioSeleccionado');
    }
}
```

**Regla #17 ‚Äî Comandos**
```javascript
// Presentation/commands/comandoBase.js
export class ComandoBase {
    constructor(viewmodel) {
        this.viewmodel = viewmodel;
        this._ejecutado = false;
    }

    puedeEjecutar() {
        return !this.viewmodel.ocupado;
    }

    async ejecutar(...args) {
        throw new Error('M√©todo ejecutar debe ser implementado');
    }

    deshacer() {}
}

export class ComandoGuardarUsuario extends ComandoBase {
    constructor(viewmodel) {
        super(viewmodel);
        this._respaldo = null;
    }

    async ejecutar() {
        if (!this.puedeEjecutar()) return false;

        if (this.viewmodel._usuarioSeleccionado) {
            this._respaldo = { ...this.viewmodel._usuarioSeleccionado.toJSON() };
        }

        const resultado = await this.viewmodel.guardarActual();
        if (resultado) {
            this._ejecutado = true;
        }
        return resultado;
    }

    deshacer() {
        if (this._ejecutado && this._respaldo) {
            this.viewmodel.mensajeEstado = 'Operaci√≥n deshecha';
            this.viewmodel.cargarUsuarios();
        }
    }
}
```

**Regla #18 ‚Äî Binding Vista‚ÄìViewModel con React**
```jsx
// User_Interface/vistas/VistaUsuarios.jsx (React)
import React, { useState, useEffect } from 'react';

export function VistaUsuarios({ viewmodel }) {
    const [usuarios, setUsuarios] = useState([]);
    const [filtro, setFiltro] = useState('');
    const [ocupado, setOcupado] = useState(false);
    const [mensaje, setMensaje] = useState('');

    useEffect(() => {
        const handleCambio = (evento) => {
            switch (evento.nombre) {
                case 'usuarios':
                    setUsuarios([...viewmodel.usuarios]);
                    break;
                case '_ocupado':
                    setOcupado(viewmodel.ocupado);
                    break;
                case '_mensajeEstado':
                    setMensaje(viewmodel.mensajeEstado);
                    break;
            }
        };

        viewmodel.on('cambio', handleCambio);
        return () => viewmodel.off('cambio', handleCambio);
    }, [viewmodel]);

    const handleFiltroChange = (e) => {
        setFiltro(e.target.value);
        viewmodel.filtroNombre = e.target.value;
    };

    return (
        <div className="vista-usuarios">
            <div className="toolbar">
                <input
                    type="text"
                    placeholder="Filtrar por nombre..."
                    value={filtro}
                    onChange={handleFiltroChange}
                />
                <button 
                    onClick={() => viewmodel.cargarUsuarios()}
                    disabled={ocupado}
                >
                    ‚Üª Recargar
                </button>
            </div>

            {ocupado && <div className="spinner">Cargando...</div>}
            
            {mensaje && <div className="mensaje">{mensaje}</div>}

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    {usuarios.map(u => (
                        <tr key={u.id} onClick={() => viewmodel.seleccionarUsuario(u)}>
                            <td>{u.id}</td>
                            <td>{u.nombre}</td>
                            <td>{u.email}</td>
                            <td>{u.activo ? '‚úÖ' : '‚ùå'}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );
}
```

**Regla #19 ‚Äî Backend como Proveedor de ViewModels**
```javascript
// backend.js (extendido para MVVM)
import { UsuarioViewModel } from './Presentation/viewmodels/usuarioViewModel.js';

export class Backend {
    constructor(config = {}) {
        // ... inicializaci√≥n existente ...
        this._inicializarViewModels();
    }

    _inicializarViewModels() {
        this.viewModelUsuario = new UsuarioViewModel(this);
        this.viewModelProducto = new ProductoViewModel(this);
    }

    obtenerViewModelUsuario() {
        return this.viewModelUsuario;
    }

    obtenerViewModelProducto() {
        return this.viewModelProducto;
    }
}
```

**Regla #20 ‚Äî Bootstrap Integrado**
```javascript
// bootstrap.js (con React)
import React from 'react';
import { createRoot } from 'react-dom/client';
import { Backend } from './backend.js';
import { VistaUsuarios } from './User_Interface/vistas/VistaUsuarios.jsx';
import { VistaProductos } from './User_Interface/vistas/VistaProductos.jsx';

class Application {
    constructor() {
        this.backend = null;
    }

    inicializar() {
        this.backend = new Backend({ dbPath: 'data/dev.db' });
    }

    ejecutar() {
        const root = document.getElementById('root');
        const reactRoot = createRoot(root);

        reactRoot.render(
            <React.StrictMode>
                <div className="app">
                    <h1>Mi Aplicaci√≥n</h1>
                    <div className="tabs">
                        <VistaUsuarios 
                            viewmodel={this.backend.obtenerViewModelUsuario()}
                        />
                        <VistaProductos 
                            viewmodel={this.backend.obtenerViewModelProducto()}
                        />
                    </div>
                </div>
            </React.StrictMode>
        );
    }

    cerrar() {
        if (this.backend) {
            this.backend.cerrar();
        }
    }
}
```

### Asincron√≠a en MVVM

```javascript
class UsuarioViewModel extends ViewModelBase {
    async cargarUsuarios() {
        this.ocupado = true;
        this.mensajeEstado = 'Cargando usuarios...';
        this.notificarCambio('ocupado');

        try {
            const dtos = await this.backend.obtenerUsuarios();
            this._usuarios = dtos.map(dto => UIUsuario.fromDTO(dto));
            this.mensajeEstado = `${this._usuarios.length} usuarios cargados`;
            this.notificarCambio('usuarios');
        } catch (error) {
            this.mensajeEstado = `Error: ${error.message}`;
        } finally {
            this.ocupado = false;
            this.notificarCambio('ocupado');
            this.notificarCambio('mensajeEstado');
        }
    }
}
```

### Estructura Completa ‚Äî Nivel 5

```
proyecto/
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend.js
‚îú‚îÄ‚îÄ bootstrap.js
‚îú‚îÄ‚îÄ config.js
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ servicios/
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/
‚îÇ
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ entidades/
‚îÇ   ‚îú‚îÄ‚îÄ value-objects/
‚îÇ   ‚îú‚îÄ‚îÄ eventos/
‚îÇ   ‚îî‚îÄ‚îÄ excepciones/
‚îÇ
‚îú‚îÄ‚îÄ Infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ persistencia/
‚îÇ   ‚îú‚îÄ‚îÄ servicios-externos/
‚îÇ   ‚îî‚îÄ‚îÄ logging/
‚îÇ
‚îú‚îÄ‚îÄ Presentation/
‚îÇ   ‚îú‚îÄ‚îÄ viewmodels/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ viewmodelBase.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuarioViewModel.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ productoViewModel.js
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uiUsuario.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators.js
‚îÇ   ‚îî‚îÄ‚îÄ commands/
‚îÇ       ‚îú‚îÄ‚îÄ comandoBase.js
‚îÇ       ‚îî‚îÄ‚îÄ comandosUsuario.js
‚îÇ
‚îú‚îÄ‚îÄ User_Interface/
‚îÇ   ‚îú‚îÄ‚îÄ vistas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VistaUsuarios.jsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VistaProductos.jsx
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TablaDatos.jsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Formulario.jsx
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ app.css
‚îÇ
‚îú‚îÄ‚îÄ Tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_domain/
‚îÇ   ‚îú‚îÄ‚îÄ test_application/
‚îÇ   ‚îú‚îÄ‚îÄ test_infrastructure/
‚îÇ   ‚îî‚îÄ‚îÄ test_presentation/
‚îÇ       ‚îú‚îÄ‚îÄ test_usuarioViewModel.js
‚îÇ       ‚îî‚îÄ‚îÄ test_validators.js
‚îÇ
‚îú‚îÄ‚îÄ Scripts/
‚îÇ   ‚îú‚îÄ‚îÄ migraciones.js
‚îÇ   ‚îî‚îÄ‚îÄ seed.js
‚îÇ
‚îî‚îÄ‚îÄ Docs/
    ‚îú‚îÄ‚îÄ README.md
    ‚îî‚îÄ‚îÄ arquitectura.md
```

---

## CLI Dev Pattern para Node.js

El CLI Dev Pattern es una extensi√≥n del patr√≥n AETHERYON orientada espec√≠ficamente a herramientas de l√≠nea de comandos que operan sobre sistemas reales: repositorios, proyectos, pipelines, agentes.

### Anatom√≠a del CLI Dev Pattern

```
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                     ‚îÇ         FUENTES DE DATO       ‚îÇ
                     ‚îÇ  (archivos, git, APIs)        ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                     ‚îÇ
                                     ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                  CAPA DE ALMACENAMIENTO (Core)           ‚îÇ
      ‚îÇ           SQLite / JSON / Git como verdad √∫nica          ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ                  ‚îÇ                  ‚îÇ
                 ‚ñº                  ‚ñº                  ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ   MODELS API     ‚îÇ ‚îÇ   EXPORT / I/O   ‚îÇ ‚îÇ AUTOMATIONS /    ‚îÇ
      ‚îÇ  (dominio puro)  ‚îÇ ‚îÇ  Markdown ¬∑ JSON ‚îÇ ‚îÇ AGENTS (futuro)  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                    ‚îÇ                    ‚îÇ
               ‚ñº                    ‚ñº                    ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ       CLI        ‚îÇ ‚îÇ       GUI        ‚îÇ ‚îÇ    BIT√ÅCORA      ‚îÇ
      ‚îÇ  velocidad,      ‚îÇ ‚îÇ  navegaci√≥n,     ‚îÇ ‚îÇ  relato,         ‚îÇ
      ‚îÇ  scripting       ‚îÇ ‚îÇ  foco humano     ‚îÇ ‚îÇ  reportes        ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                    ‚îÇ                    ‚îÇ
               ‚ñº                    ‚ñº                    ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ    COMANDOS      ‚îÇ ‚îÇ  CONTROLES GUI   ‚îÇ ‚îÇ    SALIDAS       ‚îÇ
      ‚îÇ  open / close    ‚îÇ ‚îÇ  Nueva ¬∑ Editar  ‚îÇ ‚îÇ  export.md       ‚îÇ
      ‚îÇ  add / remove    ‚îÇ ‚îÇ  Filtros ¬∑ Orden ‚îÇ ‚îÇ  JSON ¬∑ informes ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ             ESTADOS DE PROGRESO              ‚îÇ
      ‚îÇ  Checkpoints ¬∑ Steps ¬∑ Progreso (%)          ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### AppState como coordinador

```javascript
// infrastructure/estado/appState.js
import simpleGit from 'simple-git';
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

export class AppState {
    constructor() {
        this.proyecto = null;
        this.archivosData = new Map(); // indice_fila: ruta_relativa
    }

    async abrirProyecto(ruta) {
        this.proyecto = new Proyecto(ruta);
        this.git = simpleGit(ruta);
        await this.proyecto.cargarEstado();
        return this.proyecto;
    }

    async obtenerEstadoArchivos() {
        const status = await this.git.status();
        return status.files;
    }

    async ejecutarComandoGit(...args) {
        return await this.git.raw(args);
    }

    async abrirVSCode() {
        if (!this.proyecto) throw new Error('No hay proyecto abierto');
        await execAsync(`code "${this.proyecto.ruta}"`);
    }

    async crearRepoGitHub(nombre, privado = false) {
        const comando = `gh repo create ${nombre} ${privado ? '--private' : '--public'} --source=. --remote=origin --push`;
        await execAsync(comando, { cwd: this.proyecto.ruta });
    }
}

class Proyecto {
    constructor(ruta) {
        this.ruta = ruta;
        this.nombre = require('path').basename(ruta);
    }

    async cargarEstado() {
        // Cargar configuraci√≥n del proyecto
    }
}
```

### Reglas del CLI Dev Pattern

**Regla CLI-1 ‚Äî El Core no conoce la interfaz.**
```javascript
// ‚úÖ BIEN
export class Core {
    constructor(storage) {
        this.storage = storage;
    }
    
    async obtenerDatos() {
        return this.storage.leer();
    }
}

// ‚ùå MAL
export class Core {
    constructor() {
        this.storage = new SQLiteStorage(); // dependencia concreta
    }
}
```

**Regla CLI-2 ‚Äî Los comandos son at√≥micos.**
```javascript
// cli/comandos/comandoCheckpoint.js
import { ComandoBase } from './comandoBase.js';

export class ComandoCheckpoint extends ComandoBase {
    constructor(appState) {
        super();
        this.appState = appState;
    }

    async ejecutar(mensaje) {
        if (!this.appState.proyecto) {
            throw new Error('No hay proyecto abierto');
        }

        // Crear checkpoint en git
        await this.appState.ejecutarComandoGit('add', '.');
        await this.appState.ejecutarComandoGit('commit', '-m', `checkpoint: ${mensaje}`);
        
        // Registrar en bit√°cora
        const checkpoint = {
            timestamp: new Date().toISOString(),
            mensaje,
            hash: await this.appState.ejecutarComandoGit('rev-parse', 'HEAD')
        };
        
        return checkpoint;
    }
}
```

**Regla CLI-3 ‚Äî GUI y CLI comparten dominio.**
```javascript
// Ambos usan el mismo AppState
const appState = new AppState();

// CLI
program
    .command('abrir <ruta>')
    .action(async (ruta) => {
        await appState.abrirProyecto(ruta);
        console.log(`‚úÖ Proyecto abierto: ${ruta}`);
    });

// GUI
function BotonAbrirProyecto({ appState }) {
    const handleClick = async () => {
        await appState.abrirProyecto(selectedPath);
        // UI se actualiza mediante binding
    };
}
```

**Regla CLI-4 ‚Äî AppState es de sesi√≥n.**
```javascript
// El estado se puede reconstruir desde el Core
export class AppState {
    async reconstruirDesdeCore() {
        const config = await this.core.leerConfiguracion();
        this.proyecto = new Proyecto(config.ultimoProyecto);
        await this.proyecto.cargarEstado();
    }
}
```

### Ejemplo completo: CLI para gesti√≥n de proyectos

```javascript
#!/usr/bin/env node
// cli.js - CLI para gesti√≥n de proyectos con git

import { program } from 'commander';
import inquirer from 'inquirer';
import chalk from 'chalk';
import { AppState } from './infrastructure/estado/appState.js';
import { ComandoCheckpoint } from './cli/comandos/comandoCheckpoint.js';
import { Bitacora } from './infrastructure/bitacora/bitacora.js';

class CLIApp {
    constructor() {
        this.appState = new AppState();
        this.bitacora = new Bitacora();
    }

    async iniciar() {
        program
            .version('1.0.0')
            .description('CLI para gesti√≥n de proyectos');

        program
            .command('abrir <ruta>')
            .description('Abrir un proyecto')
            .action(async (ruta) => {
                try {
                    await this.appState.abrirProyecto(ruta);
                    console.log(chalk.green(`‚úÖ Proyecto abierto: ${ruta}`));
                } catch (error) {
                    console.log(chalk.red(`‚ùå Error: ${error.message}`));
                }
            });

        program
            .command('checkpoint <mensaje>')
            .description('Crear un checkpoint (commit)')
            .action(async (mensaje) => {
                try {
                    const comando = new ComandoCheckpoint(this.appState);
                    const resultado = await comando.ejecutar(mensaje);
                    console.log(chalk.green(`‚úÖ Checkpoint creado: ${resultado.hash.substring(0, 7)}`));
                } catch (error) {
                    console.log(chalk.red(`‚ùå Error: ${error.message}`));
                }
            });

        program
            .command('status')
            .description('Ver estado del proyecto')
            .action(async () => {
                try {
                    const archivos = await this.appState.obtenerEstadoArchivos();
                    console.log(chalk.cyan('\nüìÅ Estado del proyecto:'));
                    archivos.forEach(f => {
                        const color = f.working_dir === 'M' ? 'yellow' : 
                                    f.working_dir === '?' ? 'red' : 'green';
                        console.log(chalk[color](`  ${f.path} [${f.working_dir}]`));
                    });
                } catch (error) {
                    console.log(chalk.red(`‚ùå Error: ${error.message}`));
                }
            });

        program
            .command('vscode')
            .description('Abrir proyecto en VS Code')
            .action(async () => {
                try {
                    await this.appState.abrirVSCode();
                    console.log(chalk.green('‚úÖ VS Code abierto'));
                } catch (error) {
                    console.log(chalk.red(`‚ùå Error: ${error.message}`));
                }
            });

        program
            .command('bitacora')
            .description('Ver √∫ltima entrada de bit√°cora')
            .action(async () => {
                const ultima = await this.bitacora.obtenerUltima();
                console.log(chalk.cyan('\nüìù √öltima entrada:'));
                console.log(ultima);
            });

        await program.parseAsync(process.argv);
    }
}

const app = new CLIApp();
app.iniciar().catch(console.error);
```

---

## Migraci√≥n entre Niveles

### De Nivel 1 a Nivel 2 (JavaScript)

1. Crear `backend.js` y mover toda la l√≥gica de negocio.
2. Crear `cli.js` (o `ui.js`) con solo la interacci√≥n de usuario.
3. El frontend importa el backend con `require` o `import`.
4. Asegurar que `backend.js` no tenga `console.log` ni interacci√≥n directa con el usuario.

### De Nivel 2 a Nivel 3

1. Crear estructura de carpetas: `Domain/`, `Application/`, `Infrastructure/`.
2. Mover entidades a `Domain/entidades/`.
3. Extraer interfaces a `Application/interfaces/`.
4. Mover acceso a datos a `Infrastructure/persistencia/`.
5. Mover servicios orquestadores a `Application/servicios/`.
6. Convertir `backend.js` en adaptador y crear `bootstrap.js`.

### De Nivel 3 a Nivel 4

1. Instalar Jest y configurar testing.
2. Crear `Tests/` con estructura espejo.
3. Escribir tests para Domain primero.
4. Agregar `Scripts/` para migraciones y seed.
5. Crear `Docs/` con README.md.

### De Nivel 4 a Nivel 5

1. Crear `Presentation/` con viewmodels, models, commands.
2. Crear `ViewModelBase` primero.
3. Migrar l√≥gica de UI de `User_Interface/` a ViewModels.
4. Implementar binding en las vistas.
5. Agregar `test_presentation/` en Tests.

---

## Conclusi√≥n

El patr√≥n AETHERYON para JavaScript/Node.js proporciona una arquitectura progresiva y escalable:

- **Nivel 1** ‚Äî Script √∫nico con `commander` para CLI.
- **Nivel 2** ‚Äî BF: separaci√≥n backend/frontend con m√≥dulos CommonJS o ES.
- **Nivel 3** ‚Äî AUDI: arquitectura por capas con inyecci√≥n de dependencias.
- **Nivel 4** ‚Äî AUDDITS: testing con Jest, scripts y documentaci√≥n JSDoc.
- **Nivel 5** ‚Äî AUDDITS + MVVM: ViewModels observables con EventEmitter.

**Principios clave adaptados a Node.js:**
- Usar ES modules (`import`/`export`) para mejor tree-shaking.
- Inyecci√≥n de dependencias en constructores.
- Tests con Jest para todas las capas.
- Documentaci√≥n con JSDoc para APIs p√∫blicas.
- `backend.js` como facade que expone servicios a la UI.
- `bootstrap.js` como punto de entrada que configura logging, BD y entorno.
```

Esta versi√≥n mantiene todos los conceptos del patr√≥n original pero adaptados al ecosistema JavaScript/Node.js, incluyendo:

1. **Sintaxis ES modules** moderna con `import/export`
2. **CLI con commander** para el Nivel 1
3. **Testing con Jest** para el Nivel 4
4. **MVVM con React** como ejemplo para el Nivel 5
5. **Manejo de asincron√≠a** con async/await
6. **EventEmitter** para el sistema de notificaciones del ViewModel
7. **package.json** en cada nivel con dependencias apropiadas
8. **Ejemplos funcionales** que se pueden ejecutar directamente

El patr√≥n mantiene la filosof√≠a original de progresi√≥n controlada, permitiendo que los proyectos crezcan en complejidad de manera ordenada sin reescrituras completas.
